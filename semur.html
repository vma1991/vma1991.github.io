
<!doctype html>
<html lang="fr">

	<head>
		<title>vma1991</title>

		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="style.css">

		<script src="https://cdn.plot.ly/plotly-2.12.1.min.js"></script>
	</head>

	<body>
		<div id="pages-icon">
			<a href="http://vma1991.github.io">
				<img src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJ
bWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdp
bj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6
eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0
NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJo
dHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlw
dGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAv
IiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RS
ZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpD
cmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFu
Y2VJRD0ieG1wLmlpZDpFNTE3OEEyQTk5QTAxMUUyOUExNUJDMTA0NkE4OTA0RCIgeG1wTU06RG9j
dW1lbnRJRD0ieG1wLmRpZDpFNTE3OEEyQjk5QTAxMUUyOUExNUJDMTA0NkE4OTA0RCI+IDx4bXBN
TTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU1MTc4QTI4OTlBMDExRTI5
QTE1QkMxMDQ2QTg5MDREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU1MTc4QTI5OTlBMDEx
RTI5QTE1QkMxMDQ2QTg5MDREIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4
bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+m4QGuQAAAyRJREFUeNrEl21ojWEYx895TDPbMNlB
K46IUiNmPvHBSUjaqc0H8pF5+aDUKPEBqU2NhRQpX5Rv5jWlDIWlMCv7MMSWsWwmb3tpXub4XXWd
PHvc9/Gc41nu+nedc7/8r/99PffLdYdDPsvkwsgkTBwsA/PADJCnzX2gHTwBt8Hl7p537/3whn04
XoDZDcpBlk+9P8AFcAghzRkJwPF4zGGw0Y9QS0mAM2AnQj77FqCzrtcwB1Hk81SYojHK4DyGuQ6m
hIIrBWB9Xm7ug/6B/nZrBHBegrkFxoVGpnwBMSLR9EcEcC4qb8pP14BWcBcUgewMnF3T34VqhWMF
kThLJAalwnENOAKiHpJq1FZgI2AT6HZtuxZwR9GidSHtI30jOrbawxlVX78/AbNfhHlomEUJJI89
O2MqeE79T8/nk8nMBm/dK576hZgmA3cp/R4l9/UeSxiHLVIlNm4nFfT0bxyuIj7LHRTKai+zdJob
wMKzcZSJb0ePV5PKN+BqAAKE47UlMnERELMM3EdYP/yrd+XYb2mOiYBiQ8OQnoRBlXrl9JZix7D1
pHTazu4MoyBcnYamqAjIMTR8G4FT8LuhLsexXYYjICBiqhQBvYb6fLZIJCjPypVvaOoVAW2WcasC
nL2Nq82xHJNSqlCeFcDshaPK0twkAhosjZL31QYw+1rlMpWGMArl23SBsZZO58F2tlJXmjOXS+s4
WGvpMiBJT/I2PInZ6lIs9/hBsNS1hS6BG0DSqmYEDRlCXQrmy50P1oDRKTSegmNbUsA0zDMwRhPJ
XeCE3vWLPQMvan6X8AgIa1vcR4AkGZkDR4ejJ1UHpsaVI0g2LInpOsNFUud1rhxSV+fzC9Woz2EZ
kWQuja7/B+jUrgtIMpy9YCW4n4K41YfzRneW5E1KJTe4B2Zq1Q5EHEtj4U3AfEzR5SVY4l7QYQPJ
dN2as7RKBF0BPZqqH4VgMAMBL8Byxr7y8zCZiDlnOcEKIPmUpgB5Z2ww5RdOiiRiNajUmWda5IG6
WbhsyY2fx6m8gLcoJDJFkH219M3We1+cnda93pfycZpIJEL/s/wSYADmOAwAQgdpBAAAAABJRU5E
rkJggg==">
			</a>
		</div>

		<h3><a href="index.html">vma1991<sub>.github.io</sub></a></h3>

		<h3>Semur</h3>

		<p>Aggr&eacute;gateur d'informations - Semur en Auxois et environs</p>

		<ul>
			<li><a href="#mairieSemur">Mairie de Semur</a></li>
			<li><a href="#bienPublic">Bien Public C&ocirc;te d'Or</a></li>
			<li><a href="#hydroPont">Lac de Pont : sondes hydrom&eacute;triques</a></li>
			<li><a href="#">Nappe phr&eacute;atique Saulieu : pi&eacute;zom&egrave;tre</a></li>
		</ul>

		<div id="divMairieSemur">
			<a id="mairieSemur"></a>
			<h2>Mairie de Semur</h2>
			<div id="divSemurMairieStatus"></div>
			<div id="divSemurMairieActu"></div>
			<div id="divSemurMairieAgenda"></div>
		</div>

		<div id="divBienPublic">
			<a id="bienPublic"></a>
			<h2>Bien Public C&ocirc;te d&apos;Or</h2>
			<div id="divBienPublicStatus"></div>
			<div id="divBienPublicActu"></div>
		</div>

		<div id="divHydroPont">
			<a id="hydroPont"></a>
			<h2>Lac de Pont : sondes hydrom&eacute;triques</h2>
			<div id="divHydroPontStatus"></div>
			<div id="divHydroPontAmontH"></div>
			<div id="divHydroPontAvalH"></div>
			<div id="divHydroPontAvalQ"></div>
		</div>

		<div id="divPiezo">
			<a id="piezo"></a>
			<h2>Nappe phr&eacute;atique Saulieu : pi&eacute;zom&egrave;tre</h2>
			<div id="divPiezoStatus"></div>
			<div id="divPiezoLevel"></div>
		</div>

		<script type="text/javascript">

			divSemurMairieStatus = document.getElementById('divSemurMairieStatus');
			divSemurMairieActu = document.getElementById('divSemurMairieActu');
			divSemurMairieAgenda = document.getElementById('divSemurMairieAgenda');

			divBienPublicStatus = document.getElementById('divBienPublicStatus');
			divBienPublicActu = document.getElementById('divBienPublicActu');

			divHydroPontStatus = document.getElementById('divHydroPontStatus');
			divHydroPontAmontH = document.getElementById('divHydroPontAmontH');
			divHydroPontAvalH = document.getElementById('divHydroPontAvalH');
			divHydroPontAvalQ = document.getElementById('divHydroPontAvalQ');

			divPiezo = document.getElementById('divPiezo');
			divPiezoStatus = document.getElementById('divPiezoStatus');
			divPiezoLevel = document.getElementById('divPiezoLevel');

			function getSemur(){

				divSemurMairieStatus.insertAdjacentHTML('beforeend', 'Loading... &#9203;');
				divBienPublicStatus.insertAdjacentHTML('beforeend', 'Loading... &#9203;');
				divHydroPontStatus.insertAdjacentHTML('beforeend', 'Loading... &#9203;');
				divPiezoStatus.insertAdjacentHTML('beforeend', 'Loading... &#9203;');

				const reqHeaders = {
					"apikey": "9455a76bb03c5a8f8305"
				};

				//const reqUrl = 'http://localhost:5000/semur/';
				const reqUrl = 'https://nnoi.se/api/semur/';
				const apiReq = new Request(reqUrl, {headers: reqHeaders});

				fetch(apiReq)
				.then(response => response.json())
				.then(data => {
					divSemurMairieStatus.replaceChildren();
					mairieSemurActu(data);
					mairieSemurAgenda(data);

					divBienPublicStatus.replaceChildren();
					bienPublic(data);

					divHydroPontStatus.replaceChildren();
					hydroHAmont(data);
					hydroHAval(data);
					hydroQAval(data);

					divPiezoStatus.replaceChildren();
					piezoH(data);
				})
				.catch(e => {
					divSemurMairieStatus.insertAdjacentHTML('beforeend', '<br>' + e);
					divBienPublicStatus.insertAdjacentHTML('beforeend', '<br>' + e);
				});
			}

			function mairieSemurActu(data){

				h3MairieSemurActu = document.createElement('h3');
				h3MairieSemurActu.innerHTML = "Actualit&eacute;s";
				divSemurMairieActu.appendChild(h3MairieSemurActu);

				if ('error' in data.mairie_semur_post){
					divSemurMairieActu.insertAdjacentHTML('beforeend', 'API Error - ' + data.mairie_semur_post.error);
					return
				}

				toInsert = '<ul>';
				for (var i = 0 ; i < data.mairie_semur_post.length ; i++){
					toInsert += '<li><a href="' + data.mairie_semur_post[i].url + '" target="_blank">'
						+ data.mairie_semur_post[i].title + '</a></li>';
				}
				toInsert += '</ul>';

				divSemurMairieActu.insertAdjacentHTML('beforeend', toInsert);

			}

			function mairieSemurAgenda(data){

				h3MairieSemurAgenda = document.createElement('h3');
				h3MairieSemurAgenda.textContent = "Agenda";
				divSemurMairieAgenda.appendChild(h3MairieSemurAgenda);

				if ('error' in data.mairie_semur_agenda){
					divSemurMairieAgenda.insertAdjacentHTML('beforeend', 'API Error - ' + data.mairie_semur_agenda.error);
					return
				}

				toInsert = '<ul>';
				for (var i = 0 ; i < data.mairie_semur_agenda.length ; i++){
					toInsert += '<li><a href="' + data.mairie_semur_agenda[i].url + '" target="_blank">'
						+ data.mairie_semur_agenda[i].title + '</a></li>';
				}
				toInsert += '</ul>';

				divSemurMairieAgenda.insertAdjacentHTML('beforeend', toInsert);

			}

			function bienPublic(data){

				if ('error' in data.bien_public){
					divBienPublicActu.insertAdjacentHTML('beforeend', 'API Error - ' + data.bien_public.error);
					return
				}

				toInsert = '<ul>';
				for (var i = 0 ; i < data.bien_public.length ; i++){
					toInsert += '<li><a href="' + data.bien_public[i].url + '" target="_blank">'
						+ data.bien_public[i].title + '</a></li>';
				}
				toInsert += '</ul>';

				divBienPublicActu.insertAdjacentHTML('beforeend', toInsert);
			}

			function hydroHAmont(data){

				if ('error' in data.hydro_h.hydro_h_amont){
					divHydroPontAmontH.insertAdjacentHTML('beforeend', 'API Error - ' + data.hydro_h.hydro_h_amont.error);
					return
				}

				X = data.hydro_h.hydro_h_amont.map(obs => obs.date_obs);
				Y = data.hydro_h.hydro_h_amont.map(obs => obs.resultat_obs);

				var amontHPlot = {
					x: X,
					y: Y
				};

				var amontHLayout = {
					title: 'Sonde amont barrage : hauteur d\'eau (mm)'
				};

				divHydroPontAmontH.style.maxWidth = '800px';
				Plotly.newPlot(divHydroPontAmontH, [amontHPlot], amontHLayout);
			}

			function hydroHAval(data){

				if ('error' in data.hydro_h.hydro_h_aval){
					divHydroPontAvalH.insertAdjacentHTML('beforeend', 'API Error - ' + data.hydro_h.hydro_h_aval.error);
					return
				}

				X = data.hydro_h.hydro_h_aval.map(obs => obs.date_obs);
				Y = data.hydro_h.hydro_h_aval.map(obs => obs.resultat_obs);

				var avalHPlot = {
					x: X,
					y: Y
				};

				var avalHLayout = {
					title: 'Sonde aval barrage : hauteur d\'eau (mm)'
				};

				divHydroPontAvalH.style.maxWidth = '800px';
				Plotly.newPlot(divHydroPontAvalH, [avalHPlot], avalHLayout);
			}

			function hydroQAval(data){

				if ('error' in data.hydro_q){
					divHydroPontAvalQ.insertAdjacentHTML('beforeend', 'API Error - ' + data.hydro_q.error);
					return
				}

				X = data.hydro_q.map(obs => obs.date_obs);
				Y = data.hydro_q.map(obs => obs.resultat_obs);

				var avalQPlot = {
					x: X,
					y: Y
				};

				var avalQLayout = {
					title: 'Sonde aval barrage : dÃ©bit (l/h)'
				};

				divHydroPontAvalQ.style.maxWidth = '800px';
				Plotly.newPlot(divHydroPontAvalQ, [avalQPlot], avalQLayout);
			}

			function piezoH(data){

				if ('error' in data.nappe_piezo){
					divPiezoLevel.insertAdjacentHTML('beforeend', 'API Error - ' + data.nappe_piezo.error);
					return
				}

				X = data.nappe_piezo.map(obs => obs.date_mesure);
				Y = data.nappe_piezo.map(obs => obs.profondeur_nappe);

				var piezoPlot = {
					x: X,
					y: Y
				};

				var piezoLayout = {
					title: 'Nappe phrÃ©atique socle du Morvan (Saulieu) : distance entre sol et surface de l\'eau',
					xaxis: {autorange: 'reversed'}
				};

				divPiezoLevel.style.maxWidth = '800px';
				Plotly.newPlot(divPiezoLevel, [piezoPlot], piezoLayout);
			}

			getSemur();
			
		</script>
		
	</body>

</html>
